@model IEnumerable<BeerWebshop.APIClientLibrary.ApiClient.DTO.ProductDTO>
@{
    ViewData["Title"] = "Alle produkter";
    string selectedSortOrder = ViewBag.CurrentSortOrder ?? "";
    string selectedCategory = ViewBag.CurrentCategory ?? "";
    int currentPage = ViewBag.CurrentPage ?? 0; 
    int totalPages = ViewBag.TotalPages ?? 1; 
}

<style>
    .pagination-link {
        margin-right: 10px; /* Space between the links */
    }

    .pagination-link:last-child {
        margin-right: 0; /* No margin on the last link */
    }

    .pagination-text {
        color: black; /* White color for the non-clickable page number */
        margin-right: 10px; /* Same spacing as links */
    }

    .pagination-link.active {
        font-weight: bold; /* Optional: style for the active page */
    }

    .card {
        min-height: 400px; /* Ensure cards have a minimum height */
        display: flex;
        flex-direction: column;
    }

    .card-body {
        flex-grow: 1; /* Makes sure the body takes available space */
        display: flex;
        flex-direction: column;
    }

    .truncated-text {
        display: -webkit-box;
        -webkit-line-clamp: 3; /* Limit to 3 lines */
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 15px; /* Ensure a small gap between the description and price */
    }

    .card-footer {
        margin-top: auto; /* Ensure footer stays at the bottom */
        padding: 10px 0; /* Adjust footer padding for consistency */
        text-align: center; /* Center the button */
    }

    .fixed-price {
        margin-top: auto; /* Pushes the price list to the bottom of the card */
        margin-bottom: 0; /* Remove default margin at bottom */
        list-style-type: none; /* Remove bullet points */
    }

    .card-body h5, .card-body h6 {
        margin-bottom: 10px; /* Adjust space between title, subtitle, and description */
    }

    .card-body ul {
        margin-top: auto; /* Ensure the price is pushed to the bottom */
    }



</style>

<form method="get" asp-action="Index">
    <div class="row mb-3">
        <div class="col-md-4">
            <label for="sortOrder">Sorter efter:</label>
            <select id="sortOrder" name="SortBy" class="form-control">
                <option value="nameAsc" selected="@(selectedSortOrder == "nameAsc")">Navn stigende (A-Å)</option>
                <option value="nameDesc" selected="@(selectedSortOrder == "nameDesc")">Navn faldende (Å-A)</option>
                <option value="priceAsc" selected="@(selectedSortOrder == "priceAsc")">Pris stigende</option>
                <option value="priceDesc" selected="@(selectedSortOrder == "priceDesc")">Pris faldene</option>
            </select>
        </div>
        <div class="col-md-4">
            <label for="category">Kategori:</label>
            <select id="category" name="Category" class="form-control">
                <option value="">Alle kategorier</option>
                @foreach (var category in ViewBag.Categories as IEnumerable<string>)
                {
                    <option value="@category" selected="@(category == selectedCategory)">@category</option>
                }
            </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary">Anvend</button>
        </div>
    </div>
</form>

<div class="row">
    <div class="row">
    @foreach (var item in Model)
    {
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <a asp-action="Details" asp-route-id="@item.Id" style="text-decoration: none; color: inherit;">
                    <img class="card-img-top" style="max-height: 200px; object-fit: cover;"
                         src="@(string.IsNullOrEmpty(item.ImageUrl) ? "https://storage.googleapis.com/pod_public/1300/163656.jpg" : item.ImageUrl)"
                         alt="@item.Name" />

                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">@item.Name</h5>
                        <h6 class="card-subtitle text-muted">@item.BreweryName</h6>
                        <p class="card-text truncated-text">@item.Description</p>

                        <!-- Fixed Price at the bottom -->
                        <ul class="list-unstyled fixed-price">
                            <li><strong>Pris:</strong> @item.Price kr.</li>
                        </ul>
                    </div>
                </a>
                <div class="card-footer">
                    <button type="button"
                            class="btn btn-primary add-to-cart"
                            data-product-id="@item.Id">
                        Tilføj til kurv
                    </button>
                </div>
            </div>
        </div>
    }
</div>



</div>

<div class="pagination d-flex justify-content-center mt-4">
    <div class="pagination-links">
        @if (currentPage > 0)
        {
            <a href="@Url.Action("Index", new { pageNumber = currentPage - 1, SortBy = selectedSortOrder, Category = selectedCategory })">Tilbage</a>
        }

        @for (int i = Math.Max(0, currentPage); i <= Math.Min(Math.Max(0, currentPage) + 2, totalPages); i++)
        {
            if (i == Math.Max(0, currentPage))
            {
                <span class="pagination-text">@i</span> 
            }
            else
            {
                <a href="@Url.Action("Index", new { pageNumber = i, SortBy = selectedSortOrder, Category = selectedCategory })" class="pagination-link @((i == currentPage) ? "active" : "")">@i</a>
            }
        }


        @if (currentPage < totalPages)
        {
            <a href="@Url.Action("Index", new { pageNumber = currentPage + 1, SortBy = selectedSortOrder, Category = selectedCategory })">Næste</a>
        }

    </div>
</div>



<div id="notification" class="notification"></div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.add-to-cart').on('click', function (event) {
                event.preventDefault();
                var productId = $(this).data('product-id');

                $.ajax({
                    url: '/Cart/AddToCart',
                    method: 'POST',
                    data: { productId: productId, quantity: 1 },

                    success: function (response) {
                        $('#cart-item-count').text(response.cartItemCount);
                        window.showNotification('Varen blev tiføjet til kurven', 'success');
                    },
                    error: function (xhr) {
                        var errorMessage = xhr.responseText || 'Kunne ikke tilføje varen til kurv.';
                        window.showNotification(errorMessage, 'error');
                    }
                });
            });
        });
    </script>
}        