CREATE TABLE Categories (
    Id INT PRIMARY KEY,
    [Name] NVARCHAR(255) NOT NULL,
    IsDeleted BIT DEFAULT 0 
);

CREATE TABLE Breweries (
    Id INT PRIMARY KEY,
    [Name] NVARCHAR(255) NOT NULL,
    IsDeleted BIT DEFAULT 0
);

CREATE TABLE Postalcode (
    Postalcode INT PRIMARY KEY,
    City NVARCHAR(255) NOT NULL
);

CREATE TABLE Address (
    Id INT PRIMARY KEY IDENTITY,
    Street NVARCHAR(255) NOT NULL,
    StreetNumber NVARCHAR(50) NOT NULL,
    ApartmentNumber NVARCHAR(50) NOT NULL,
    Postalcode_FK INT NOT NULL,
    UNIQUE (Street, StreetNumber, ApartmentNumber, Postalcode_FK),
    FOREIGN KEY (Postalcode_FK) REFERENCES Postalcode (Postalcode)
);

CREATE TABLE Customers (
    Id INT PRIMARY KEY IDENTITY,
    FirstName NVARCHAR(255) NOT NULL,
    LastName NVARCHAR(255) NOT NULL,
    Phone NVARCHAR(50) NOT NULL,
    PasswordHash NVARCHAR(255) NOT NULL,
    AddressId_FK INT NOT NULL,
    IsDeleted BIT NOT NULL DEFAULT 0,
    FOREIGN KEY (AddressId_FK) REFERENCES Address (Id) ON DELETE CASCADE
);


CREATE TABLE Products (
    Id INT PRIMARY KEY,
    [Name] NVARCHAR(255) NOT NULL,
    CategoryId_FK INT,
    BreweryId_FK INT,
    Price FLOAT NOT NULL,
    [Description] NVARCHAR(255),
    Stock INT DEFAULT 0,
    Abv FLOAT,
    [RowVersion] ROWVERSION,
    ImageUrl NVARCHAR(255),
    IsDeleted BIT DEFAULT 0, 
    FOREIGN KEY (CategoryId_FK) REFERENCES Categories (Id) ON DELETE SET NULL,
    FOREIGN KEY (BreweryId_FK) REFERENCES Breweries (Id) ON DELETE SET NULL
);
CREATE TABLE Orders (
    Id INT PRIMARY KEY,
    CreatedAt DATETIME NOT NULL,
    IsDelivered BIT DEFAULT 0,
    CustomerId_FK INT NOT NULL,
    IsDeleted BIT DEFAULT 0, 
    FOREIGN KEY (CustomerId_FK) REFERENCES Customers (Id) ON DELETE CASCADE
);

CREATE TABLE Orderlines (
    OrderId INT,
    ProductId INT,
    Quantity INT NOT NULL,
    Total FLOAT NOT NULL,
    PRIMARY KEY (OrderId, ProductId),
    FOREIGN KEY (OrderId) REFERENCES Orders (Id) ON DELETE CASCADE,
    FOREIGN KEY (ProductId) REFERENCES Products (Id) ON DELETE NO ACTION
);
